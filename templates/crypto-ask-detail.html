{% include  'partials/main.html' %}
{% load static %}
{% load humanize %}

<head>
    {% include 'partials/title-meta.html' with page_title=ask.ask %}

    <!-- Css -->
    {% include 'partials/head-css-dark.html' %}

    <style>
        .star {
            font-size: 24px;
            cursor: pointer;
            color: white;
        }

        .star:hover, .star.active {
            color: gold; /* Color for hovered and active stars */
        }


        .filled {
            color: gold;
        }
    </style>
</head>

{% include 'partials/body.html' %}


{% include 'partials/navbar/nav-crypto.html' %}


<!-- Hero Start -->
<section class="bg-half-170 d-table w-100 bg-light">

    <div class="container">
        <div class="position-static text-center">
            <nav aria-label="breadcrumb" class="d-inline-block">
                <ul class="breadcrumb rounded shadow mb-0 px-4 py-2">
                    <li class="breadcrumb-item"><a href='{% url "ask" %}'>HỎI ĐÁP</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'ask_category' ask.category.slug%}">{{ask.category}}</a></li>
<!--                    <li class="breadcrumb-item active" aria-current="page">{{ask.ask}</li>-->
                </ul>
            </nav>
        </div>
        <div class="col-md-12 mb-3 mt-3 text-center">
            <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#questionModal">Đặt câu
                hỏi
            </button>
        </div>
        <div id="carouselExampleInterval" class="carousel slide mb-2" data-bs-interval="false">
            <div class="carousel-inner">
                {% for category in list_asks_category %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <div class="d-flex align-items-center">
                        <div class="bg-overlay"></div>
                        <div class="container">
                            <div class="row mt-5 justify-content-center">
                                <div class="col-12 text-center text-white">
                                    <h5 class="text-white title-dark mb-5"><a
                                            href="{% url 'ask_category' category.slug%}"
                                            class="title h5 text-dark mb-5">{{category.name}}</a>
                                    </h5>
                                </div><!--end col-->
                            </div><!--end row-->
                        </div>
                    </div><!--end slide-->
                </div>
                {% endfor %}

            </div>
            <a class="carousel-control-prev" href="#carouselExampleInterval" role="button"
               data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleInterval" role="button"
               data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </a>
        </div>
        <div class="card mb-3">
            <div class="card-body">
                <strong>Hỏi:</strong> {{ask.ask|safe}}
            </div>
            {% if ask.answer %}
            <div class="card-body">
                {{ask.content|safe}}
            </div>
            <div class="star-rating card-body text-center" data-ask-id="{{ ask.id }}">
                {% for i in "12345" %}
                <!--                <span class="star" data-rating="{{ i }}">★</span>-->
                <span class="star {% if i <= ask.rating %} filled {% endif %}" data-rating="{{ i }}"
                      style='color: gold'>★</span>
                {% endfor %}
                <p>Đánh giá hiện tại: <span id="current-rating">{{ ask.rating }}  </span> / 5</p>
            </div>

            {% endif %}
        </div>
        <div class="table-responsive features-absolute shadow-md rounded-md" style="margin-top:50px">
            <table class="table mb-0 table-center">
                <thead>
                <tr>
                    <th scope="col" class="fw-normal border-bottom text-muted py-4 px-3"
                        style="width: 150px;">Sàn giao dịch
                    </th>
                    <th scope="col" class="fw-normal border-bottom text-muted py-4 px-3"
                        style="width: 150px;">
                        Xếp hạng
                    </th>
                    <th scope="col" class="fw-normal border-bottom text-muted py-4 px-3"
                        style="width: 150px;">
                        Volume
                    </th>
                </tr>
                </thead>

                <tbody>
                {%for item in list_format_exchanges %}
                <tr>
                    <th class="p-3">
                        <div class="align-items-center">
                            <img src="{{item.thumb}}"
                                 alt="Crypto Symbol" class="me-3" height="32">
                            <p class="mb-0 d-inline fw-normal h6">{{item.name}} <span
                                    class="text-muted">{{item.symbol}}</span>
                            </p>
                            {% if item.name == 'Binance'%}
                            <a
                                    href="https://accounts.binance.com/vi/register?ref=B61KRIA2"
                                    class="btn btn-sm btn-primary" target="_blank">Đăng ký</a>
                            {%endif%}
                        </div>
                    </th>
                    <td class="p-3">{{item.trust_score_rank}}</td>
                    <td class="p-3">${{item.trade_volume_24h_btc|floatformat:2|intcomma}}</td>
                </tr>
                {% endfor %}
                </tbody>
            </table><!--end table-->
        </div>
    </div><!--end container-->
    <div class="modal fade" id="questionModal" tabindex="-1" role="dialog" aria-labelledby="questionModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="questionModalLabel">Đặt câu hỏi</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="post" action="{% url 'add_ask' %}">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="question-input">Câu hỏi của bạn</label>
                            <input name="ask" type="text" class="form-control" id="question-input"
                                   placeholder="Nhập câu hỏi...">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                        <button type="submit" class="btn btn-primary">Gửi câu hỏi</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section><!--end section-->
<!-- End -->


<!-- Footer Start -->
{% include  'partials/footer/footer-three.html' %}
<!-- Footer End -->

{% include  'partials/offcanvas-right.html' %}
{% include  'partials/switcherbar.html' %}

<!-- Back to top -->
<a href="#" onclick="topFunction()" id="back-to-top" class="back-to-top fs-5"><i data-feather="arrow-up"
                                                                                 class="fea icon-sm icons align-middle"></i></a>
<!-- Back to top -->

<!-- javascript -->
{% include  'partials/vendor-scripts.html' %}
<!-- Main Js -->
<script src='{% static "assets/libs/feather-icons/feather.min.js" %}'></script>
<script src='{% static "assets/js/plugins.init.js" %}'></script><!--Note: All init js like tiny slider, counter, countdown, maintenance, lightbox, gallery, swiper slider, aos animation etc.-->
<script src='{% static "assets/js/app.js" %}'></script><!--Note: All important javascript like page loader, menu, sticky menu, menu-toggler, one page menu etc. -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Add click event listener to stars
        $('.star').click(function () {
            const askId = $(this).parent().data('ask-id');
            const rating = $(this).data('rating');

            // Update the current rating display
            $('#current-rating').text(rating);

            // Send an AJAX request to Django view to save the rating
            $.ajax({
                type: 'POST',
                url: '{% url "rate_ask" %}',
                data: {
                    'askId': askId,
                    'rating': rating,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                success: function (data) {
                    // Handle success response, if needed
                    console.log('Rating saved successfully.');
                },
                error: function (error) {
                    // Handle error response, if needed
                    console.error('Error while saving rating:', error);
                },
            });
        });
    });
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</body>

</html>
